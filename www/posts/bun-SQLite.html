
<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title></title>
  <link rel="shortcut icon" type="static/image/png" href="images/favicon-16x16.png" />
  <link rel="stylesheet" type="text/css" href="/static/css/normalize.min.css">
  <link rel="stylesheet" type="text/css" href="/static/css/styles.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville&family=Source+Sans+Pro&display=swap"
    rel="stylesheet">
  <link rel="alternate" type="application/rss+xml" title="" href="/rss">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="A Developer blog for Chris Hughes. Specializes in JavaScript, Rust, Web development, SQL" />
  <script src="https://unpkg.com/htmx.org@1.9.10"
    integrity="sha384-D1Kt99CQMDuVetoL1lrYwg5t+9QdHe7NLX/SoJYkXDFfX37iInKRy5xLSi8nO7UC" crossorigin="anonymous" defer>
    </script>
  <script src="/static/js/menu.js" defer></script>
  <script src="/static/js/colors.js" defer></script>
</head>


<header class="desktop">
  <nav>
    <a href="/about" hx-get="/cards" hx-swap="innerHTML" hx-push-url="/" hx-target="#contentDiv">
      <h2>Chris Hughes dot Dev</h2>
    </a>
    <div class="social-links">
      <a href="/about" hx-get="/resume" hx-swap="innerHTML" hx-push-url="/resume"
        hx-target="#contentDiv">Resume</a>
      <a href="https://github.com/naokontai" target="_blank" rel="noopener noreferrer">
        GitHub
      </a>
      <a href="/about" hx-get="/about" hx-swap="innerHTML" hx-push-url="/about" hx-target="#contentDiv">About</a>
      <a href="mailto: chris@chris-hughes.dev">
        <i class="fa-solid fa-envelope"></i>
      </a>
      <a href="/rss">
        <i class="fa-solid fa-rss"></i>
      </a>
      <button id="theme-toggle">
        <i id="moon" class="fa-regular fa-moon"></i>
        <i id="bulb" class="fa-regular fa-lightbulb"></i>
      </button>
    </div>
  </nav>
</header>
<header class="mobile">
  <nav>
    <a href="/cards" hx-get="/cards" hx-swap="innerHTML" hx-push-url="/" hx-target="#contentDiv">
      <h2>Chris Hughes.Dev</h2>
    </a>
    <a href="javascript:void(0);" onclick="handleSocial()">
      <i class="fa fa-bars menu"></i>
    </a>
  </nav>
</header>
<div id="social-menu" style="display: none;">
  <div class="mobile-social">
    <a href="/rss">
      <i class="fa-solid fa-rss"></i>
    </a>
    <a href="mailto: chris@chris-hughes.dev">
      <i class="fa-solid fa-envelope"></i>
    </a>
    <a href="https://github.com/naokontai" target="_blank" rel="noopener noreferrer">
      <i class="fa-brands fa-github"></i>
    </a>
    <a href="/resume" hx-get="/resume" hx-swap="innerHTML" hx-push-url="/resume" hx-target="#contentDiv">
      <i class="fa-regular fa-address-card"></i>
    </a>
    <button id="theme-toggle-mobile">
      <i id="moon-mobile" class="fa-regular fa-moon"></i>
      <i id="bulb-mobile" class="fa-regular fa-lightbulb"></i>
    </button>
  </div>
</div>

<div id="contentDiv" class="contentDiv">

<title>Bun SQLite</title>
<summary>
  Using Bun's builtin SQLite module to store CSV data
</summary>
<h1>Bun SQLite</h1>
<small class="date">Published: Sun, 31 Mar 2024 00:08:29-4:00</small>
<br>
<small class="tech">TypeScript | SQLite</small>

<p>
  I recently had a school project where I needed to build a simple web application by taking some sample data from a CSV
  file to build a book web store. I quickly determined that I didn't want to deal with parsing a CSV files throughout my
  application every time I needed the data, and I was even less interested in trying to update that data. I decided that
  the best route would be to just parse the CSV file once, build a SQLite database and then use the SQLite.
  Additionally, I could add a <code>createCsv()</code> function that could build a new CSV file from the working
  database.
</p>

<p>
  I thought this was an interesting project because I could see it coming up in the real world. A business owner wants a
  website, but they haven't been using a proper database because they have been tracking their inventory via Excel or
  something similar, and now they want a website. Great, I was ready to get started, but I was confronted with the age
  old task of sifting through NPM packages to find suitable modules for the tasks I didn't want to do manually.
</p>
<div id="outline-container-orgc3aedb1" class="outline-2">
  <h2 id="orgc3aedb1">Bun to the Rescue!</h2>
  <div class="outline-text-2" id="text-orgc3aedb1">
    <p>
      Lucky for me after my initial investigation, I realized that the Bun team was good enough to add in a simple <a
        href="https://bun.sh/docs/api/sqlite">SQLite driver module</a> to Bun itself (Not to mention I recently stumbled
      across their nifty <a href="https://bun.sh/docs/runtime/shell">shell module</a>). I am a big fan of the inclusion
      of these features into Bun because, when I am working on a simple prototype application, the last thing I want to
      do is sift through NPM packages and try to parse through whatever random method was chosen for the documentation;
      I just want to open up Emacs and start writing some JavaScript. That is precisely what Bun's SQLite driver allows
      me to do. You still have the option to use something from NPM, but you don't have to go searching for a means to
      use something as simple as a basic SQLite database or a .env file in the early stages of building a project.
    </p>
  </div>
</div>
<div id="outline-container-org0e91d56" class="outline-2">
  <h2 id="org0e91d56">Generating the database</h2>
  <div class="outline-text-2" id="text-org0e91d56">
    <p>
      Generating a table is dead simple. You just need to import the Bun SQLite module, create a database object and
      then use the <code>query()</code> and <code>run()</code> methods to create a table.
    </p>

    <div class="org-src-container">
      <pre class="src src-javascript"><span style="color: #6f80ff; font-weight: bold;">import</span> <span
          style="color: #379cf6;">{</span> Database <span style="color: #379cf6;">}</span> from <span
          style="color: #df805f;">"bun:sqlite"</span>;

        <span style="color: #6f80ff; font-weight: bold;">const</span> <span style="color: #af85ff;">db</span>: Database
        = <span style="color: #6f80ff; font-weight: bold;">new</span> <span style="color: #029fff;">Database</span><span
          style="color: #379cf6;">(</span><span style="color: #df805f;">":memory:"</span><span
          style="color: #379cf6;">)</span>;

        db.query<span style="color: #379cf6;">(</span><span style="color: #df805f;">`</span>
        <span style="color: #df805f;">CREATE TABLE books (</span>
        <span style="color: #df805f;">id integer primary key,</span>
        <span style="color: #df805f;">title text,</span>
        <span style="color: #df805f;">author text,</span>
        <span style="color: #df805f;">genre text,</span>
        <span style="color: #df805f;">price real,</span>
        <span style="color: #df805f;">image text,</span>
        <span style="color: #df805f;">available boolean</span>
        <span style="color: #df805f;">);</span>
        <span style="color: #df805f;">`</span><span style="color: #379cf6;">)</span>.run<span
          style="color: #379cf6;">()</span>

      </pre>
    </div>

    <p>
      I put the database in memory because its just a demo, but you could of course supply a file path to the
      <code>Database</code> constructor as well.
    </p>

    <p>
      All I had left to do was to parse the CSV file and insert it into the database. I chose to use <a
        href="https://www.papaparse.com/">Papa Parse</a> to parse the CSV file (I chose it, admittedly, somewhat
      randomly), and it was serviceable, but for some reason it was adding a junk object that only had an
      <code>BookID</code> key that was empty. Instead of figuring out why, I just filtered it out of the results. If I
      were doing more than just a demo, I probably would have dug into this rather odd result a bit further, or better
      yet, it might be just as easy to create a custom function to parse the CSV file manually.
    </p>

    <p>
      Before I could actually work with the data, I needed to create some types. I try to make a habit of using
      TypeScript where possible on small projects, so that I am more familiar and practiced with it when I need it for
      larger projects. First I created a <code>BookCsv</code> type that would hold the result form Papa parse and a
      <code>Book</code> type that represented the actual database schema. I created the extra <code>Book</code> type
      because Papa parse wanted the object's keys to match the field names. I figured it was easiest to just create two
      types, so that I could make sure that the object keys followed js naming conventions.
    </p>

    <div class="org-src-container">
      <pre class="src src-javascript"><span style="color: #6f80ff; font-weight: bold;">import</span> <span
          style="color: #379cf6;">{</span> Database <span style="color: #379cf6;">}</span> from <span
          style="color: #df805f;">"bun:sqlite"</span>;
        <span style="color: #6f80ff; font-weight: bold;">import</span> Papa, <span style="color: #379cf6;">{</span> type
        ParseResult <span style="color: #379cf6;">}</span> from <span style="color: #df805f;">'papaparse'</span>;
        <span style="color: #6f80ff; font-weight: bold;">import</span> type <span style="color: #379cf6;">{</span> Book,
        BookCsv <span style="color: #379cf6;">}</span> from <span style="color: #df805f;">'./types.ts'</span>

        <span style="color: #6f80ff; font-weight: bold;">const</span> <span style="color: #af85ff;">db</span>: Database
        = <span style="color: #6f80ff; font-weight: bold;">new</span> <span style="color: #029fff;">Database</span><span
          style="color: #379cf6;">(</span><span style="color: #df805f;">":memory:"</span><span
          style="color: #379cf6;">)</span>;

        <span style="color: #6f80ff; font-weight: bold;">const</span> <span style="color: #af85ff;">csv</span> = <span
          style="color: #6f80ff; font-weight: bold;">await</span> Bun.file<span style="color: #379cf6;">(</span><span
          style="color: #df805f;">"data/booksdata.csv"</span><span style="color: #379cf6;">)</span>.text<span
          style="color: #379cf6;">()</span>;
        <span style="color: #6f80ff; font-weight: bold;">const</span> <span style="color: #af85ff;">books</span>:
        ParseResult&lt;BookCsv&gt; = Papa.parse<span style="color: #379cf6;">(</span>csv, <span
          style="color: #d0730f;">{</span> header: <span style="color: #379cf6;">true</span> <span
          style="color: #d0730f;">}</span><span style="color: #379cf6;">)</span>;

        books.data.forEach<span style="color: #379cf6;">(</span>book =&gt; <span style="color: #d0730f;">{</span>
        <span style="color: #6f80ff; font-weight: bold;">if</span> <span style="color: #6f80ff;">(</span>book.Title<span
          style="color: #6f80ff;">)</span> <span style="color: #6f80ff;">{</span>
        <span style="color: #6f80ff; font-weight: bold;">const</span> <span style="color: #af85ff;">insert</span>: Book
        = <span style="color: #df805f;">{</span>
        id: book.BookID,
        title: book.Title,
        author: book.Author,
        genre: book.Genre,
        price: book.Price,
        image: book.ImageFileName,
        available: book.Available,
        <span style="color: #df805f;">}</span>
        db.query<span style="color: #df805f;">(</span><span style="color: #df805f;">`</span>
        <span style="color: #df805f;">INSERT INTO books (title, author, genre, price, image, available)</span>
        <span style="color: #df805f;">VALUES ($title, $author, $genre, $price, $image, $available);</span>
        <span style="color: #df805f;">`</span><span style="color: #df805f;">)</span>.values<span
          style="color: #df805f;">(</span><span style="color: #0dafdf;">{</span>
        $title: insert.title,
        $author: insert.author,
        $genre: insert.genre,
        $price: insert.price,
        $image: insert.image,
        $available: insert.available,
        <span style="color: #0dafdf;">}</span><span style="color: #df805f;">)</span>;
        <span style="color: #6f80ff;">}</span>
        <span style="color: #d0730f;">}</span><span style="color: #379cf6;">)</span>;
      </pre>
    </div>

    <p>
      I use the <code>Book</code> type to insert into the database and then when I need to get the data out I can use
      that same type with a select statement. I used the object method for inserting the data, but you can also use the
      question mark style and then supply an array of values that match the question marks.
    </p>
  </div>
</div>
<div id="outline-container-org8d4610b" class="outline-2">
  <h2 id="org8d4610b">As Easy as That</h2>
  <div class="outline-text-2" id="text-org8d4610b">
    <p>
      The amount of code and effort it would have required to use node for this would have been virtually the same, but
      I like not always have to make decisions, and Bun is fast becoming my go to js runtime for these kinds of projects
      for that reason alone. You can access the wealth of NPM packages if you need them, but very often I find myself
      installing the same packages over and over just to perform relatively simple tasks, and in those cases having
      something that is a bit more opinionated and has some of these quality of life modules is exactly what I am
      looking for.
    </p>
  </div>
</div>


</div>

<footer>
  <div>
    <a href="/">Home</a>
    <a href="mailto: chris@chris-hughes.dev">Email</a>
    <div>
      <small>&copy; Chris Hughes 2025</small>
    </div>
  </div>
</footer>

</html>
